*/ Общее описание БД и решаемых ею задач:
* БД использовалась ранее в работе транспортной компании, на сегодня назрела необходимость переноса ее данных в другую БД.
* Разработчиками разработана модель загрузки в определенном формате.
* Наша задача собрать данные в данный формат и обеспечить загрузку в новую БД.
*/

CREATE DATABASE project;

USE project;

DROP TABLE IF EXISTS moneyzack;
CREATE TABLE moneyzack (
  id SERIAL PRIMARY KEY,
  zayav_id VARCHAR(255),
  zayav_num INT COMMENT 'Номер заявки',
  date_zayav  DATE COMMENT 'Дата заявки',
  firmzack VARCHAR(255) COMMENT 'Наименование заказчика',
  firmzack_id INT
) COMMENT = 'Номера заявок';

INSERT INTO moneyzack (zayav_id, zayav_num, date_zayav, firmzack, firmzack_id)
VALUES
(6185794, '114', '2021-10-05', 'ООО "Мегатранс"','627'),
(5496540, '100', '2021-10-03', 'ООО "ТЕРМ Транс"','88738'),
(5312090, '115', '2021-10-07', 'ОАО "АЛТРАНС"','638'),
(5367373, '230', '2021-11-05', 'ИП Шабанов Ю.C."','2632'),
(5351644, '101', '2021-09-05', 'АО "Гормашины"','757470'),
(5340520, '102', '2021-09-06', 'ООО "Мегатранс"','627'),
(5315178, '116', '2021-10-08', 'ООО "КЛТ ПЛЮС"','1255053'),
(5323499, '103', '2021-09-07', 'ООО «ИркСнаб»','295259'),
(5378439, '104', '2021-09-15', 'ООО «ИркСнаб»"','295259'),
(5442463, '105', '2021-09-16', 'АО "СКБ Сибэлектро"','531447');


DROP TABLE IF EXISTS firmzack;
CREATE TABLE firmzack (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) COMMENT 'Наименование заказчика',
  INN BIGINT COMMENT 'ИНН',
  firmzack_id INT,
  firmzack_adress TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Заказчики';
INSERT INTO firmzack (name, INN, firmzack_id, firmzack_adress)
VALUES
('ООО "Мегатранс"', '6166034398','627','344029, г. Ростов-на-Дону, пр.Сельмаш, 20/51'),
('ООО "ТЕРМ Транс"','5406257887','88738','630091, г. Новосибирск ул. Потанинская, 9'),
('ОАО "АЛТРАНС"','2221000387','638','г. Барнаул, Павловский тракт, 28'),
('ИП Шабанов Ю.C."','160501159747','2632','422527, Республика Татарстан,  Зеленодольский р-он, с  Осиново,  ул  Центральная,  4'),
('АО "Гормашины"','5904997117','757470','614064, Пермский край, г. Пермь, ул. Льва Шатрова, 29'),
('ООО "КЛТ ПЛЮС"','6165211527','1255053','344069, г. Ростов-на-Дону, ул. Таганрогская, 116а'),
('ООО «ИркСнаб»','3808137137','295259','664011, г. Иркутск, ул. Рабочая, 2 "А", офис 519'),
('АО "СКБ Сибэлектро"','5403102221','531447','630088, г. Новосибирск, ул. Петухова, 51');

DROP TABLE IF EXISTS per_firmname;
CREATE TABLE per_firmname (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) COMMENT 'Наименование перевозчика',
  INN BIGINT COMMENT 'ИНН',
  per_firmname_id INT,
  per_firmname_adress TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Перевозчики';
INSERT INTO per_firmname (name, INN, per_firmname_id, per_firmname_adress)
VALUES
('ООО ТЭК "Инфотранс"', '6658474667','628','620102, г. Екатеринбург, ул. Белореченская, 4/144'),
('ООО «Транспортная Компания «Томичка»','7017263508','88739','634063, Томская область, г.Томск, ул. Торговая, 8, стр 1 , помещение 9'),
('ООО "АвтоАльянс"','7105521067','639','300010, г. Тула, ул. Хворостухина, 5'),
('ООО "ТК Континент"','2224153568','2633','656011, г.Барнаул, проспект Калинина, 24/1, офис 401'),
('ООО «ТрейдКлинБилдинг»','6659199692','757471','620141, Екатеринбург,  ул. Завокзальная, 19, офис 2'),
('ООО "Авега"','5405451882','1255054','630009, г. Новосибирск, ул. Большевистская, 101, офис 1014'),
('ООО "АбсолютТранс"','6674363555','295260','620087, г. Екатеринбург, ул. Самолетная, 1, офис 136'),
('ООО "ОЛ-ТРАНС"','6950136498','531448','170001, г. Тверь, б-р Ногина, 4, корпус 2, офис 17');

DROP TABLE IF EXISTS users;
CREATE TABLE users (
	id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
	firstname VARCHAR(50) NOT NULL,
	surname VARCHAR(50) NOT NULL,
	email VARCHAR(120) UNIQUE,
	phone CHAR(11) NOT NULL,
	per_firmname_id INT,
	firmzack_id INT,
	INDEX (phone),
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP
	) COMMENT = 'Контакты контрагентов';

INSERT INTO users (id, firstname, surname, email, phone, per_firmname_id, firmzack_id, created_at)
VALUES
(1,'Сергей','Сергеев','qwe@asdf.qw',123123123,'628', NULL,'2021-09-25 22:09:27'),
(2,'Ирина','Кийко','cattack2@unc.edu',2139527247, NULL,'627','2020-09-25 23:14:25'),
(3,'Виктория','Водопьянова','scasotti3@usgs.gov', 4187011526, '88739', NULL, '2020-09-25 22:09:27'),
(4,'Пётр','Иванов','13sss51jpalfreeman11@example.com',6843424170, NULL,'88738','2020-09-25 22:09:27'),
(5,'Аноним','Анонимов5','anonymous5@anonymous.qw',123123123,'639', NULL,'2020-09-25 22:09:27'),
(6,'Дмитрий','Тимашов','segginton4@cam.ac.uk',4513359033, NULL,'638','2020-09-25 22:09:27'),
(7,'Владислав','Авраменко','aswaddle5@altervista.org',1874462339,'2633', NULL,'2020-09-25 22:09:27'),
(8,'Алексей','Величко','fleahey6@ftc.gov',2951798252, NULL,'2632','2020-09-25 22:09:27'),
(9,'Артем','Филипцов','rcasley7@exblog.jp',3237322265,'757471', NULL,'2020-09-25 22:09:27'),
(10,'Елена','Колдаева','rlantry8@pen.io',3731144657, NULL,'757470','2020-09-25 22:09:27'),
(11,'Андрей','Антипов','egoatcher9@behance.net',8774858608,'1255054', NULL,'2020-09-25 22:09:27'),
(12,'Евгений','Грачев','dcolquita@ucla.edu',9744906651,NULL,'1255053','2020-09-25 23:20:59'),
(13,'Аноним','Анонимов13','anonymous13@anonymous.qw',123123123,'295260', NULL,'2020-09-25 22:09:27'),
(14,'Фёдор','Иванов','13sss51222jpalfreeman11@example.com',6843424170, NULL,'295259','2020-09-25 22:09:27'),
(15,'Аноним','Анонимов15','anonymous15@anonymous.qw',123123123,'531448', NULL,'2020-09-25 22:09:27');

DROP TABLE IF EXISTS pogras;
CREATE TABLE pogras (
  id SERIAL PRIMARY KEY,
  name_marshrut VARCHAR(255) COMMENT 'Маршрут',
  zayav_num VARCHAR(255),
  date_zayav  DATE COMMENT 'Дата заявки',
  adress_pog TEXT COMMENT 'Адрес погрузки',
  adress_ras TEXT COMMENT 'Адрес разгрузки',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
  ) COMMENT = 'Маршрут';
INSERT INTO pogras (name_marshrut, zayav_num, date_zayav, adress_pog, adress_ras)
VALUES
('Ростов-на-Дону - Новосибирск', '114', '2021-10-05', 'Ростов-на-Дону','Новосибирск'),
('Новосибирск - Обь', '100', '2021-10-03', 'Новосибирск','Обь'),
('Барнаул - Новосибирск', '115', '2021-10-07', 'Барнаул','Новосибирск'),
('Татарстан, село Осиново - Новосибирск', '230', '2021-11-05', 'Татарстан, село Осиново','Новосибирск'),
('Пермь', '101', '2021-09-05', 'Пермь','Новосибирск'),
('Ростов-на-Дону - Новосибирск', '102', '2021-09-06', 'Ростов-на-Дону','Новосибирск'),
('Новосибирск - Ростов-на-Дону', '116', '2021-10-08', 'Новосибирск','Ростов-на-Дону'),
('Иркутск - Новосибирск', '103', '2021-09-07', 'Иркутск','Новосибирск'),
('Новосибирск - Иркутск', '104', '2021-09-15', 'Новосибирск','Иркутск'),
('Новосибирск - Бердск', '105', '2021-09-16', 'Новосибирск','Бердск');

DROP TABLE IF EXISTS grus;
CREATE TABLE grus (
  id SERIAL PRIMARY KEY,
  zayav_id VARCHAR(255),
  grus_id INT UNSIGNED,
  grus_name VARCHAR(50) NOT NULL,
  gr_brutto INT COMMENT 'Вес брутто',
  gr_vol INT COMMENT 'Объем груза',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Состав груза';
INSERT INTO grus (zayav_id, grus_name, gr_brutto, gr_vol)
VALUES
(6185794, 'спецодежда', '11250', '49'),
(5496540, 'МДФ', '20000', '92'),
(5312090, 'трансформаторы ', '20000', '86'),
(5367373, 'стройматериалы', '20000', '86'),
(5351644, 'колесные пары', '20000', '92'),
(5340520, 'спецодежда', '11250', '49'),
(5315178, 'мачта бурового станка', '20000', '92'),
(5323499, 'мука, крупа', '20000', '86'),
(5378439, 'мука, крупа', '20000', '86'),
(5442463, 'трансформаторы ', '20000', '86');

DROP TABLE IF EXISTS auto_tag;
CREATE TABLE auto_tag (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) COMMENT 'Гос номер тягача',
  firstname VARCHAR(50) NOT NULL,
  lastname VARCHAR(50) NOT NULL,
  phone CHAR(11) NOT NULL COMMENT 'Телефон водителя',
  zayav_id VARCHAR(255),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Данные автомобиля';

INSERT INTO `auto_tag` VALUES 
(1,'qui','Adolphus','Dicki','381.435.567','5312090','1996-08-06 21:14:46','1973-03-06 04:51:44'),
(2,'aliquid','Crystal','Hyatt','674-667-363','5315178','1994-03-22 18:38:32','1980-05-25 10:53:07'),
(3,'culpa','Katrina','Donnelly','(067)602-39','5323499','1976-01-21 11:58:14','2009-02-02 15:55:17'),
(4,'fugiat','Kelli','Mayer','(743)281-73','5340520','1971-05-20 00:19:01','1977-02-15 22:15:16'),
(5,'veritatis','Marlee','Green','469-719-352','5351644','1978-02-21 18:42:38','1997-10-17 22:54:12'),
(6,'veritatis','Anna','Wunsch','096-685-863','5367373','2013-08-31 00:59:50','1992-06-08 23:53:11'),
(7,'aut','Winona','Kling','08705825070','5378439','1975-12-06 15:33:13','1991-09-02 20:13:59'),
(8,'repellendus','Alfonso','Blick','707-138-003','5442463','1970-10-19 13:47:19','2004-12-30 04:55:49'),
(9,'inventore','Sandy','Pacocha','00686680322','5496540','2021-06-08 09:02:08','1971-09-28 23:12:51'),
(10,'rerum','Aiyana','Hand','979-694-485','6185794','1973-07-11 06:40:25','1995-11-25 05:06:41');

DROP TABLE IF EXISTS moneyper;
CREATE TABLE moneyper (
  id SERIAL PRIMARY KEY,
  zayav_id VARCHAR(255),
  value INT UNSIGNED COMMENT 'Расходы на перевозку',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Сумма расходов на перевозку';

INSERT INTO `moneyper` VALUES 
(1,'5312090',200000,'2009-02-20 02:57:13','2021-09-10 00:00:00'),
(2,'5315178',1,'1990-01-11 12:05:31','2021-09-10 00:00:00'),
(3,'5323499',50,'1977-12-19 05:24:42','2021-09-10 00:00:00'),
(4,'5340520',200,'2008-05-05 13:43:06','2021-09-10 00:00:00'),
(5,'5351644',500,'1982-01-19 19:33:51','2021-09-10 00:00:00'),
(6,'5367373',15000,'1970-07-06 07:45:29','2021-09-10 00:00:00'),
(7,'5378439',15000,'1992-11-03 08:30:33','2021-09-10 00:00:00'),
(8,'5442463',150000,'1974-08-29 17:07:16','2021-09-10 00:00:00'),
(9,'5496540',15000,'1988-04-22 07:44:04','2021-09-10 00:00:00'),
(10,'6185794',50000,'1991-01-28 03:16:54','2021-09-10 00:00:00');

DROP TABLE IF EXISTS moneydop;
CREATE TABLE moneydop (
  id SERIAL PRIMARY KEY,
  zayav_id VARCHAR(255),
  value INT UNSIGNED COMMENT 'Допрасходы',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Сумма допрасходов';

INSERT INTO `moneydop` VALUES 
(1,'5312090',50000,'2009-02-20 02:57:13','2021-09-10 00:00:00'),
(2,'5315178',5,'1990-01-11 12:05:31','2021-09-10 00:00:00'),
(3,'5323499',50,'1977-12-19 05:24:42','2021-09-10 00:00:00'),
(4,'5340520',15000,'2008-05-05 13:43:06','2021-09-10 00:00:00'),
(5,'5351644',200,'1982-01-19 19:33:51','2021-09-10 00:00:00'),
(6,'5367373',5000,'1970-07-06 07:45:29','2021-09-10 00:00:00'),
(7,'5378439',5000,'1992-11-03 08:30:33','2021-09-10 00:00:00'),
(8,'5442463',500000,'1974-08-29 17:07:16','2021-09-10 00:00:00'),
(9,'5496540',5000,'1988-04-22 07:44:04','2021-09-10 00:00:00'),
(10,'6185794',50000,'1991-01-28 03:16:54','2021-09-10 00:00:00');

DROP TABLE IF EXISTS zayav_schet;
CREATE TABLE zayav_schet (
  id SERIAL PRIMARY KEY,
  zayav_id INT,
  zayav_num INT,
  total DECIMAL (11,2) COMMENT 'Сумма заявки',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Суммы заявок';

INSERT INTO `zayav_schet` VALUES 
(1,6185794, '114', 657349.00,'1995-12-15 10:35:10','2017-08-23 01:41:29'),
(2,5496540, '100', 752504.00,'1976-03-30 08:26:05','1972-09-21 01:21:28'),
(3,5312090, '115', 76989.00,'1970-04-16 18:27:21','1977-11-17 14:53:55'),
(4,5367373, '230', 551757.00,'1988-09-12 20:39:30','2017-02-07 21:55:36'),
(5,5351644, '101', 832.00,'1979-07-29 21:48:51','1971-07-26 00:36:30'),
(6,5340520, '102', 2623.00,'1998-01-16 02:36:25','1991-06-15 22:35:26'),
(7,5315178, '116', 7.00,'1992-04-25 10:25:36','1973-12-17 05:32:32'),
(8,5323499, '103', 137.00,'1971-03-14 15:24:35','1973-06-17 22:27:58'),
(9,5378439, '104', 51772.00,'1994-06-05 14:57:48','1979-02-08 15:13:47'),
(10,5442463, '105', 512394.00,'2015-03-09 15:49:11','1979-12-28 17:51:49');

